<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feiertagskalender 2025</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap: 20px; }
    .card { border: 1px solid #ccc; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .card img { width: 100%; height: 150px; object-fit: cover; }
    .card h2 { font-size: 1em; margin: 10px; }
  </style>
</head>
<body>
  <h1>Feiertagskalender 2025</h1>
  <p><a href="InternationalDays2025_Full.ics">ICS-Datei herunterladen</a></p>
  <div class="grid" id="events"></div>
  <script src="https://cdn.jsdelivr.net/npm/ical.js@1.4.0/build/ical.min.js"></script>
  <script>
    async function loadCalendar() {
      try {
        const res = await fetch('InternationalDays2025_Full.ics');
        if (!res.ok) throw new Error(res.status);
        const text = await res.text();
        const lines = text.split(/\r?\n/).filter(l => l.trim() && !l.startsWith('#'));
        const unfolded = [];
        for (const line of lines) {
          if (/^[ \t]/.test(line) && unfolded.length) {
            unfolded[unfolded.length - 1] += line.trim();
          } else {
            unfolded.push(line);
          }
        }
        let cleaned = unfolded.join('\r\n');
        cleaned = cleaned.replace(/^([^:;\r\n]+)=/gm, '$1:');
        if (!cleaned.endsWith('END:VCALENDAR')) cleaned += '\r\nEND:VCALENDAR';
        const jcal = ICAL.parse(cleaned);
        const comp = new ICAL.Component(jcal);
        const events = comp.getAllSubcomponents('vevent');
        const custom = {
          'Internationaler_Tag_des_Bieres@intdays2025': 'https://i.ibb.co/your-path/beer.jpg',
          'Tag_der_Deutschen_Einheit@intdays2025': 'https://i.ibb.co/your-path/unity.jpg',
          'Welt-Arschbohrertag@intdays2025': 'https://i.ibb.co/q35HrPnD/arschbohrertag.jpg'
        };
        const defaultImg = 'https://via.placeholder.com/400x300?text=Kein+Bild';
        const container = document.getElementById('events');
        for (const ev of events) {
          const uid = ev.getFirstPropertyValue('uid');
          const name = ev.getFirstPropertyValue('summary').replace(/\[.*?\]/, '').trim();
          const key = encodeURIComponent(name.split(/\s+/)[0]);
          const url = custom[uid] || `https://source.unsplash.com/400x300/?${key}` || defaultImg;
          const card = document.createElement('div');
          card.className = 'card';
          const img = document.createElement('img');
          img.src = url;
          img.alt = name;
          const h2 = document.createElement('h2');
          h2.textContent = name;
          card.append(img, h2);
          container.appendChild(card);
        }
      } catch (e) {
        console.error(e);
      }
    }
    loadCalendar();
  </script>
</body>
</html>
